<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="UpdateBizTalkDebuggingConfig" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="UpdateBizTalkAppDomainConfig" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="CreateVirtualDirectory" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="DeleteVirtualDirectory" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="AssignVirtualDirectoryToAppPool" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="ConfigureAppPool" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="ConfigureWebServiceExtension" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="StripFileSpecFromPath" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="CheckForServiceInstances" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="TerminateServiceInstances" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="SetUpFileAdapterPaths" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="PopulateRulePoliciesMetadata" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="GetOsVersion" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="SetRegistryValue" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="GetRegistryValue" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="GeneratePdbCopyItemGroups" />
  <UsingTask AssemblyFile="bin\debug\DeploymentFramework.BuildTasks.dll" TaskName="GetMsbuildProcessModel" />

  <ItemGroup>
    <ABCPatternAssignmentRule Include="*">
      <AssemblyNamePattern>ABC.*, Version=1.0.0.0, Culture=neutral, PublicKeyToken=51a4d4439455a1a7</AssemblyNamePattern>
    </ABCPatternAssignmentRule>
  </ItemGroup>

  <ItemGroup>
    <XYZExactAssignmentRule Include="*">
      <AssemblyName>XYZ.Schemas, Version=1.0.0.0, Culture=neutral, PublicKeyToken=51a4d4439455a1a7</AssemblyName>
    </XYZExactAssignmentRule>
    <XYZExactAssignmentRule Include="*">
      <AssemblyName>XYZ.Transforms, Version=1.0.0.0, Culture=neutral, PublicKeyToken=51a4d4439455a1a7</AssemblyName>
    </XYZExactAssignmentRule>
  </ItemGroup>

  <ItemGroup>
    <RulePolicies Include="TestPolicy.1.0.xml">
      <LocationPath>.</LocationPath>
    </RulePolicies>
    <RulePolicies Include="TestPolicy2.xml">
      <LocationPath>.</LocationPath>
    </RulePolicies>
  </ItemGroup>
  <ItemGroup Condition="'@(RulePolicies)' != ''">
    <RulePoliciesQualified Include="@(RulePolicies->'%(LocationPath)\%(Identity)')" />
  </ItemGroup>

  <Target Name="TestAppDomainConfig">
    <UpdateBizTalkDebuggingConfig ExtendedLogging="true" ValidateCorrelations="true" />

    <UpdateBizTalkAppDomainConfig AppDomainName="ABC_1.0" SecondsIdleBeforeShutdown="1800" ConfigurationFilePath="c:\ABC.config" PatternAssignmentRules="@(ABCPatternAssignmentRule)" />

    <!--<UpdateBizTalkAppDomainConfig AppDomainName="ABC_1.0" Remove="true"/>-->

    <UpdateBizTalkAppDomainConfig AppDomainName="XYZ_1.0" SecondsIdleBeforeShutdown="1800" ConfigurationFilePath="c:\XYZ.config" Remove="false" ExactAssignmentRules="@(XYZExactAssignmentRule)" PatternAssignmentRules="@(ABCPatternAssignmentRule)" />
  </Target>

  <Target Name="TestCreateVirtualDirectory">
    <CreateVirtualDirectory MetabasePath="IIS://localhost/w3svc/1/Root" Name="BizTalkSampleVdirX" Path="C:\Inetpub" />
  </Target>

  <Target Name="TestDeleteVirtualDirectory">
    <DeleteVirtualDirectory MetabasePath="IIS://localhost/w3svc/1/Root" Name="BizTalkSampleVdirX" />
  </Target>

  <Target Name="TestAssignVirtualDirectoryToAppPool">
    <AssignVirtualDirectoryToAppPool MetabasePath="IIS://localhost/w3svc/1/Root" VDirName="BizTalkSampleVdirX" AppPoolName="TestAppPool" />
  </Target>

  <Target Name="TestConfigureAppPool">
    <ConfigureAppPool MetabasePath="IIS://localhost/w3svc/1/Root" AppPoolName="TestAppPool" UserName="CHS\tabraham" Password="abc" />
  </Target>

  <Target Name="TestConfigureWebServiceExtension">
    <ConfigureWebServiceExtension
      MetabasePath="IIS://localhost/w3svc/1/Root"
      ExtensionFile="C:\Program Files (x86)\Microsoft BizTalk Server 2009\HttpReceive64\BTSHTTPReceive.dll" ExtensionName=".\bin" Remove="True" />
  </Target>

  <Target Name="TestStripFileSpecFromPath">
    <StripFileSpecFromPath Path="C:\This\Path\a\2\42\aav\FileSpec*.*">
      <Output TaskParameter="BasePath" PropertyName="CleanFileSpec" />
    </StripFileSpecFromPath>

    <Message Text="$(CleanFileSpec)" />
  </Target>

  <Target Name="TestCheckForServiceInstances">
    <CheckForServiceInstances Application="BizTalkSample_1.0" />
  </Target>

  <Target Name="TestTerminateServiceInstances">
    <TerminateServiceInstances Application="BizTalkSample_1.0" />
  </Target>

  <Target Name="TestSetUpFileAdapterPaths">
    <SetUpFileAdapterPaths BindingFilePath="TestBinding.xml" Mode="SetUp" UserNameForFullControl="NT AUTHORITY\Network Service" />
  </Target>

  <Target Name="TestDeleteFileAdapterPaths">
    <SetUpFileAdapterPaths BindingFilePath="TestBinding.xml" Mode="DeleteIfEmpty" />
  </Target>

  <Target Name="GetOsVersion">
    <GetOsVersion>
      <Output TaskParameter="OSVersion" PropertyName="OSVersion" />
      <Output TaskParameter="IisMajorVersion" PropertyName="IisMajorVersion" />
      <Output TaskParameter="Is64BitOperatingSystem" PropertyName="Is64BitOperatingSystem" />
    </GetOsVersion>

    <Message Text="OS Version: $(OSVersion)" />
    <Message Text="IIS Major Version: $(IisMajorVersion)" />
    <Message Text="Is 64-bit OS: $(Is64BitOperatingSystem)" />
  </Target>

  <Target Name="TestPopulateRulesPolicyMetadata">
    <PopulateRulePoliciesMetadata RulePoliciesIn="@(RulePoliciesQualified)">
      <Output TaskParameter="RulePoliciesOut" ItemName="RulePoliciesQualified" />
    </PopulateRulePoliciesMetadata>
  </Target>

  <Target Name="TestSetRegistryValue">
    <SetRegistryValue KeyName="HKEY_LOCAL_MACHINE\SOFTWARE\BTDF" ValueName="TestSetting" Value="5000" ValueKind="DWord" />
  </Target>

  <Target Name="TestGetRegistryValue">
    <GetRegistryValue KeyName="HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\BizTalk ESB Toolkit\2.0" ValueName="InstallPath">
      <Output TaskParameter="Value" PropertyName="ESBToolkitInstallPath" />
    </GetRegistryValue>
    <Message Text="Value is $(ESBToolkitInstallPath)" />
  </Target>

  <ItemGroup>
    <SourceAssembly Include="BizTalkSample.Components.dll"></SourceAssembly>
  </ItemGroup>

  <Target Name="TestGeneratePdbCopyItemGroups">
    <GeneratePdbCopyItemGroups SourceAssemblies="@(SourceAssembly)">
      <Output TaskParameter="SourceItemGroup" ItemName="PdbSourceFilesGroup" />
      <Output TaskParameter="DestinationItemGroup" ItemName="PdbDestinationFilesGroup" />
    </GeneratePdbCopyItemGroups>
  </Target>

  <Target Name="TestGetMsbuildProcessModel">
    <GetMsbuildProcessModel>
      <Output TaskParameter="Is64BitProcess" PropertyName="Is64BitProcess" />
    </GetMsbuildProcessModel>

    <Message Text="Is 64-bit MSBuild?: $(Is64BitProcess)" />
  </Target>
</Project>
